#!/bin/bash




#
#  do
#    mysql -u root -p1234
#    mysql CREATE USER 'swgemu'@'localhost' IDENTIFIED BY 'l';
#    mysql GRANT ALL PRIVILEGES ON `swgemu` . * TO 'swgemu'@'localhost';
#    exit
#  done
#fi

if  [[ ! "$(/usr/sbin/service mysql status)" =~ "start/running" ]]
then 
    sudo service mysql start
    logmsg "Enter root password"
#    mysql -u root -p1234
    mysql -p -e CREATE USER 'swgemu'@'localhost' IDENTIFIED BY 'l';
    mysql -p -e GRANT ALL PRIVILEGES ON `swgemu` . * TO 'swgemu'@'localhost';
#    sudo mysql -p1234 -e CREATE USER 'swgemu' IDENTIFIED BY 'l';
#    mysql -p1234 -e GRANT ALL PRIVILEGES ON `swgemu` . * TO 'swgemu'@'localhost';
fi

#logmsg "Enter root password"
if mysql -p -NB -e 'show databases'|grep swgemu > /dev/null 2>&1; then
  logmsg "swgemu database already exists"
  :
else
  logmsg "Restore blank swgemu database to mysql"
  mysql -p -e source -e ~/workspace/Core3/MMOCoreORB/sql/swgemu.sql
#  mysql -p -e CREATE USER 'swgemu'@'localhost' IDENTIFIED BY 'l';
  mysql -p -e GRANT ALL PRIVILEGES ON `swgemu` . * TO 'swgemu'@'localhost';
  for sql in ~/workspace/Core3/MMOCoreORB/sql/updates/*.sql
  do
    logmsg "Runing mysql update: $sql"
    mysql -p swgemu -e source -e $sql
#    mysql -p -e GRANT ALL PRIVILEGES ON `swgemu` . * TO 'swgemu'@'localhost';
  done
fi


